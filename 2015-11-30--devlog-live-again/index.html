<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>ozkriff&#x27;s devlog</title>

      <!-- CSS -->
      <link rel="stylesheet" href="https:&#x2F;&#x2F;ozkriff.games&#x2F;print.css" media="print">
      <link rel="stylesheet" href="https:&#x2F;&#x2F;ozkriff.games&#x2F;poole.css">
      <link rel="stylesheet" href="https:&#x2F;&#x2F;ozkriff.games&#x2F;hyde.css">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

      
        <link rel="shortcut icon" type="image/png" href="https:&#x2F;&#x2F;ozkriff.games&#x2F;favicon.png">
      

      
        <link rel="alternate" type="application/rss+xml" title="RSS" href="https:&#x2F;&#x2F;ozkriff.games&#x2F;rss.xml">
      

      
        <!-- Global Site Tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-70829739-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-70829739-1');
        </script>
      

      
      
    </head>

    <body class=" ">
        
            <div class="sidebar">
                <div class="container ">
                    <div class="sidebar-about">
                        
                            <a href="https:&#x2F;&#x2F;ozkriff.games"><h1>ozkriff&#x27;s devlog</h1></a>
                            
                        
                    </div>

                    <ul class="sidebar-nav">
                        
                        
                        <li class="sidebar-nav-item"><a href="&#x2F;pages&#x2F;about">about</a></li>
                        
                        <li class="sidebar-nav-item"><a href="https:&#x2F;&#x2F;twitter.com&#x2F;ozkriff">twitter</a></li>
                        
                        <li class="sidebar-nav-item"><a href="https:&#x2F;&#x2F;github.com&#x2F;ozkriff">github</a></li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div class="content container">
            
<div class="post">
  <h1 class="post-title">Перезапуск журнала</h1>
  
  <span class="post-date">2015-11-30</span>
  
  <p>Насмотрелся я тут на журналы <a href="http://reangdblog.blogspot.com">reangd</a>,
<a href="http://www.gridsagegames.com/blog">cogmind</a>,
<a href="https://eao197.blogspot.ru">eao197</a> и всякие другие, решил что тоже
чего-нибудь хочу писать. С последней моей попытки прошло около полутора
лет)</p>
<p>Итак, на момент написания прошлой заметки я работал над Миром Кораблей в
<a href="https://wargaming.com/ru/about/our-locations/saint-petersburg">питерском
wargaming.net</a>.
Собственно, я успел уйти оттуда, поработать над казуалками в <a href="http://zillionwhales.ru">Zillion
Whales</a>, оттуда тоже уйти и осесть в
<a href="http://protei.ru">Протее</a>. Так что сейчас я ковыряю ip-телефонию и все игры
теперь только в свободное время, зато не надо каждый день &quot;любоваться&quot;
на ужасы фритуплея)</p>
<p>Я больше не студент, совсем - наконец-то закончил заочку в политехе,
ура-ура! :-D Темой диплома как раз и был этот проект, даже
<a href="https://ozkriff.games/2015-11-30--devlog-live-again/lesnikov_a_a_slides_2015.pdf">презентация</a> вот завалялась. Хотя
ничего особо крутого, как мне изначально хотелось, на деле не вышло.
Ключевым моментом диплома являлся ИИ. Я там подробно расписал какие они
бывают и какие виды подходят для каких игр. А вот реализовать
полноценный не успел - сдавался вариант, который только формально можно
было назвать &quot;практичным ИИ&quot; (извиняюсь, но лучшего перевода для
&quot;utility-based AI&quot; не нашел. &quot;ИИ, основанный на теории полезности&quot;
как-то длинновато). Он примерял к текущему состоянию игры захардкоженные
шаблоны на основе позиций и типов отрядов, оценивал коэффециент их
полезности, и втупую применял их. На специально подготовленных ситуациях
выглядело не так и плохо, но это отмазочный вариант, конечно. И с очень
стремным кодом, так что в git'е сейчас так и лежит базовый &quot;ИИ&quot; -
подъехать в на расстояние выстрела и стрелять :-| . Но общий обыт был
интересным)</p>
<p>Сама ржавчина, конечно, за это время сильно выросла, с 0.10 аж до 1.4.
Вместо извращений по установке зависимостей или возни с git submodules,
появился cargo. По достижении 1.0 появилась обратная совместимость. Хотя
конкретно от этого я и не в полном восторге, руки у авторов языка теперь
&quot;полусвязаны&quot;, но переписываний и правда стало меньше, только когда
библиотеки чего-то ломают. Да и с этим Cargo.lock очень помогает. Хотя,
я уже месяца полтора его не обновлял - ух и сложный же следующий
<code>cargo update</code> у меня будет.</p>
<hr />
<p>За полтора года я успел переиграть много во что повлияевшего на мое
видение пошаговых стратегий, например:</p>
<ul>
<li>
<p>малоизвестная <a href="https://store.steampowered.com/app/306640">Battle Academy
2</a> из которой я решил
фактически передрать ядро механики для тактического режима :) -
взаимодействие видов войск, быстрое/осторожное передвижение, хитрая
видимость, реакционный огонь, боевой дух/подавление и т.п.;</p>
</li>
<li>
<p>чуть более известная <a href="https://store.steampowered.com/app/218090">Unity of
Command</a> повлияла на мое
видение стратегического режима - хитрая система линий снабжения,
механика окружений и т.п.;</p>
</li>
<li>
<p>мобильная
<a href="https://play.google.com/store/apps/details?id=android.uniwar">Uniwar</a> -
классная система параллельных сетевых игр, а сама по себе игровая
механика напоминает, что шестигранникам минимализм никогда не
помешает;</p>
</li>
<li>
<p>серия Wargame, а именно
<a href="https://store.steampowered.com/app/222750">W:AB</a> и
<a href="https://store.steampowered.com/app/251060">W:RD</a> - одна из немногих
стратегий в реальном времени, в которую я с удовольствием поиграл за
долгое время. Интересна своим балансом между реализмом/&quot;веселостью&quot;
и взаимодействием между разными видами войск.</p>
</li>
</ul>
<p>Много думал про пошаговые игры без клеток, все-таки у клеток много
недостатков/особенностей. Даже немного экспериментировал - сделал
простенькое путенахождение по вручную размеченной навигационной сетке:</p>
<p><img src="https://ozkriff.games/2015-11-30--devlog-live-again/2015-07-30--manual-navmesh-simple-pathfinding.png" alt="Пример простого путенахождения на вручную размеченной сетке" /></p>
<p>Путь проложен по центрам треугольников, для оптимизации потом хотел
прикрутить <a href="http://digestingduck.blogspot.ru/2010/03/simple-stupid-funnel-algorithm.html">funnel
algorithm</a>,
но до этого этапа не дошло. Если что, шестигранники тут уже ничего не
значат, просто на основе работающего прилжожения экспериментировал.
Затем, написал простенький &quot;наращиватель&quot; препятствий, который в
зависимости от величины угла добавлял разное количество вспомогательных
отрезков:</p>
<p><img src="https://ozkriff.games/2015-11-30--devlog-live-again/2015-08-02--obstacle-grow.png" alt="Пример нарощенного препятствия" /></p>
<p>Предполагалось, что все юниты будут поделены на несколько групп по
размерам и для каждой группы будет поддерживаться своя сетка.
Непосредственно преобразованием массива таких &quot;жирных&quot; препятствий в
сетку должен был заниматься триангулятор. Мне большего всего приглянулся
плюсовый <a href="https://code.google.com/p/poly2tri">poly2tri</a>:</p>
<p><img src="https://ozkriff.games/2015-11-30--devlog-live-again/2015-08-11--triangulation-cpp-demo.png" alt="Всякие стандартные примеры из poly2tri" /></p>
<p>Даже пытался портировать его на ржавчину, но там очень стремная работа с
памятью, очень хреново укладывается в модель ржавчины. Пробовал
переделать плюсовую версию на работу с массивами и индексами, но потом
решил что очень уж много на эксперимент уходит времени, энтузиазм про
бесклеточные игры прошел, так что я совсем забросил попытку.</p>
<p>Ну да ладно, темы вдохновляющих игр, разных видов клеток и непрерывного
пространства достойны отдельных заметок, а эта запись и так большой
получается.</p>
<hr />
<p>Теперь, наконец-то, что касается самого проекта.</p>
<p>Прежде всего, он переименован из Марoдера в Зону Контроля (Zone of
Control). Сокращенно - ЗК/ZoC. Гитхабовское хранилище переехало в
<a href="https://github.com/ozkriff/zoc">https://github.com/ozkriff/zoc</a>.</p>
<p>Внешний вид с момента сдачи диплома изменился слабо и выглядит все это
безобразие сейчас как-то так:</p>
<div class="youtube"><iframe
    frameborder="0"
    allowfullscreen
    src="https://www.youtube.com/embed/srJAfngSwxk?color=white&rel=0&showinfo=0"
></iframe></div>
<p>Собственно, да, я портировал это на android, хотя под линуксом и виндой
тоже должно работать. Спасибо Skligus'y за его
<a href="https://github.com/skligys/rusty-cardboard">rusty-cardboard</a>, очень
помогло поначалу, и Tomaka за его
<a href="https://github.com/tomaka/glutin">glutin</a> и
<a href="https://github.com/tomaka/android-rs-glue">android-rs-glue</a>. К
сожалению, для сборки под андроид требуется ночная сборка rustc, потому
что в android-rs-glue используются какие-то нестабильные штуки. Хотя
надо перепроверить, может уже и стабильного компилятора хватит -
ржавчина так быстро развивается :).</p>
<p>Кстати, да, переписал с glfw-rs на
<a href="https://github.com/tomaka/glutin">glutin</a> - чем больше кода на
ржавчине, тем прощe, особенно при сборке на разных платформах. Еще хотел
со своих <a href="https://github.com/ozkriff/zoc/tree/47e8f0/src/zgl/src">костылей вокруг
OpenGL</a> перейти
на <a href="https://github.com/tomaka/glium">glium</a>, но пока не осилил.</p>
<p>Переделал с выделения через цветовой буфер на чистую математику -
пересечение луча из курсора с плоскостью карты, бла бла блап. Уж очень
много от времени отрисоки кадра оно сжирало, да и с шейдерами так меньше
хлопот.</p>
<p>Но это все про техническую часть. Что касается самой игры, то:</p>
<ul>
<li>два захардкоженых режима на одной карте с одним набором войск - против
тупого ИИ или хотсит на двух игроков;</li>
<li>от одного до пяти членов отряда в клетке -отказался от идеи иметь
несколько отрядов в слотах одной клетки, потому что так и не
придумал, как это все нормально отображать и как этим управлять.
Хотя, при введении зданий и летающих отрядов, наверное, придется тут
усложнить ситуацию;</li>
<li>до двух активных очков атаки для стрельбы по прямому приказу игрока;</li>
<li>одно пассивное очко атаки для реакционного огня в чужой ход (как в
x-com) + неиспользованные в свой ход активные очки атаки становятся
пассивными;</li>
<li>вероятность поражения с (пока что) захардкожеными вероятностями
попадания в зависимости от типа атакующего, защищающегося и
местности;</li>
<li>кривоватый туман войны, который впоследствии, видимо, будут
переведен на менее дискретный алгоритм;</li>
<li>заготовка системы боевого духа и подавления - каждый ход
восстанавливается 10 очков морали, за каждую атаку снимается по 10,
если мораль падает ниже половины - отряд не может стрелять;</li>
<li>разная стоимость движения по местности для разных отрядов;</li>
<li>два режима передвижения - быстрый и осторожный, который стоит в два
раза дороже, зато не накладывает штрафы на точность при стрельбе и
при попадании под огонь отряд не лишается оставшихся очков движения;</li>
<li>тестовый грузовик для транспортировки пехоты;</li>
<li>механика видимости из BA2 с двумя радиусами - &quot;нормальная&quot; и
&quot;отличная&quot; видимость. Последняя позволяет увидеть скрытые юниты
(например, пехоту в лесу);</li>
<li>атаки из засад, если атакующий изначально невидим, с бонусом к атаке
и шансом не раскрыть свою позицию;</li>
<li>приказ &quot;не стрелять&quot; для отключения реакционного огня при
организации хитрых засад или для разведчиков;</li>
<li>пока что только четыре вида отрядов:
<ul>
<li>пехота - четыре человека, одна клетка отличной видимости, умеют
тихориться в лесу;</li>
<li>разведчики - как пехота, только всего 2 человека, зато видят и
бегают немного быстрее;</li>
<li>танк - громко стреляет и толсто бронирован, зато у него вообще
нет отличной видимости (попробуй что через щели в броне
рассмотреть) - без пехотного прикрытия рядом с лесом ему
ездить не стоит;</li>
<li>грузовик - не умеет стрелять, очень хрупкий и подслеповатый,
зато быстрее всех остальных отрядов и может перевозить пехоту;</li>
</ul>
</li>
</ul>
<p>Ну, вот как-то так. Разработка, как видно, сильно
<a href="http://mysweetwhomp.fr/private/119228173847/tumblr_noimn4cVks1u4yjir">затянулась</a> -
- я-то хотел такое уже через пару месяцев иметь, ха! То ли мне просто
лень, то ли времени и правда мало получается выделять, черт его знает.
Уже мнооого раз полностью терял весь энтузиазм и забрасывал игру на пару
месяев, даже пытался чего-то другое делать. Но потом возвращался, что бы
все-таки надо довести до ума эту чертову ЗК :) . Да и вышеупомянутые
игры сильно помогали с вдохновением)</p>
<p>Вот, собственно, вся первая запись. Вряд ли я буду теперь пытаться
делать недельные отчеты, скорее буду писать более мелкие заметки по
настроению - регулярность вытягивает из любого дела весь интерес. Ну и
писать тут буду, наверное, не только по делу - смотрите теги :) .</p>

</div>

        </div>

    </body>

</html>
